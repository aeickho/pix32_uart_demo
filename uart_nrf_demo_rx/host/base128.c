#include "base128.h"

void
to_base128(const uint8_t * in, uint8_t * out)
{
  out[0] = (((in[0] & 0b11111110)));
  out[1] = (((in[0] & 0b00000001) << 7) | ((in[1] & 0b11111100) >> 1));
  out[2] = (((in[1] & 0b00000011) << 6) | ((in[2] & 0b11111000) >> 2));
  out[3] = (((in[2] & 0b00000111) << 5) | ((in[3] & 0b11110000) >> 3));
  out[4] = (((in[3] & 0b00001111) << 4) | ((in[4] & 0b11100000) >> 4));
  out[5] = (((in[4] & 0b00011111) << 3) | ((in[5] & 0b11000000) >> 5));
  out[6] = (((in[5] & 0b00111111) << 2) | ((in[6] & 0b10000000) >> 6));
  out[7] = (((in[6] & 0b01111111) << 1));
}


void
from_base128(const uint8_t * in, uint8_t * out)
{
  out[0] = (in[0]) | ((in[1] &0b10000000 ) >> 7 );
  out[1]= ((in[1] & 0b01111110 ) << 1) | ((in[2] & 0b11000000 )>>6); 
  out[2]= ((in[2] & 0b00111110 ) << 2) | ((in[3] & 0b11100000 )>>5); 
  out[3]= ((in[3] & 0b00011110 ) << 3) | ((in[4] & 0b11110000 )>>4); 
  out[4]= ((in[4] & 0b00001110 ) << 4) | ((in[5] & 0b11111000 )>>3); 
  out[5]= ((in[5] & 0b00000110 ) << 5) | ((in[6] & 0b11111100 )>>2); 
  out[6]= ((in[6] & 0b00000010 ) << 6) | ((in[7] & 0b11111110 )>>1); 
}

void 
to_base128n(const uint8_t * in, uint8_t * out, uint8_t n)
{
 int i;
 for (i=0; i < n; i++)
  to_base128(&in[i*7], &out[i*8]);
}

void 
from_base128n(const uint8_t * in, uint8_t * out, uint8_t n)
{
int i;
for (i=0; i < n; i++)
  from_base128(&in[i * 8], &out[i * 7]);
}


